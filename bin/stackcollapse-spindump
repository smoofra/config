#!/usr/bin/python

import re
import sys

stack_regex = re.compile(
    r' ^  (?P<indent>\s*) \*? (?P<count>\d+) \s* \?\?\? \s* (?P<name>.*?) \s* (?P<address>\[0x[0-9a-f]+\])? \s* (?P<running>\(running\))? \s* $ ',
    re.IGNORECASE | re.VERBOSE)


def read_lines(lines):
    name_stack = []
    indent_stack = []

    for line in lines:
        if line.strip() == '':
            continue
        m = re.match(stack_regex, line)

        if not m:
            raise Exception("parse error")

        indent = len(m.group('indent'))
        count =  int(m.group('count'))
        name = m.group('name')

        m = re.match(r' \s* \(* \s* (?P<name>[^ ]+)', name, re.VERBOSE)
        if m:
            name = m.group('name')

        while len(indent_stack) > 0 and indent <= indent_stack[-1]:
            name_stack.pop()
            indent_stack.pop()

        name_stack.append(name)
        indent_stack.append(indent)

        print ';'.join(name_stack), count

        # print len(m.group('indent'))
        # print m.group('count')
        # print m.group('name')
        # print m.group('address')
        # sys.exit(1)



with open(sys.argv[1], "r") as f:
    read_lines(f)
